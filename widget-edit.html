<!DOCTYPE html>
<html lang="en">

<head>
    <title>dashboard#index</title>
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/bootstrap.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/fineuploader.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/application.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/bootstrap-responsive.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/widget.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/entypo.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/bootstrap-tags.css" />
    <link href="stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/masonry-view.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/widget.css" />
    <link media="screen" rel="stylesheet" type="text/css" href="stylesheets/general.css" />

    <script src="javascripts/jquery-1.11.1.min.js"></script>
    <script src="javascripts/tooltip.js"></script>




    <link href='http://fonts.googleapis.com/css?family=Sorts+Mill+Goudy:400italic' rel='stylesheet' type='text/css'>

    <!--    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>-->
    <!--    <script type="text/javascript" src="/javascripts/cache_9ff087e3f5ef9c22eab175d938d18ddf39c0a857.js"></script>-->
    <script src="javascripts/masonry.pkgd.min.js"></script>
    <script src="javascripts/imagesloaded.pkgd.min.js"></script>


    <meta name="csrf-param" content="authenticity_token" />
    <meta charset="utf8">
    <meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
</head>

<body>
    <div class="navbar">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="/">We Own It</a>
                <ul class="nav">

                    <li class="">
                        <a href="/users">Users</a>
                    </li>

                    <li class="">
                        <a href="/widgets">Widgets</a>
                    </li>
                    <li class="">
                        <a href="/imageMappingWidgets">Image Mapping Widgets</a>
                    </li>
                    <li class="">
                        <a href="/products">Products</a>
                    </li>
                    <li class="">
                        <a href="/images">Images</a>
                    </li>

                    <li class="">
                        <a href="/brands">Brands</a>
                    </li>


                    <li class="">
                        <a href="/categories">Categories</a>
                    </li>


                    <li class="">
                        <a href="/admin">XML Import</a>
                    </li>

                </ul>
                <ul class="nav pull-right">
                    <li>
                        <a href="/edit">Marie Glahn</a>
                    </li>
                    <li>
                        <a href="/logout">Logout</a>
                    </li>
                </ul>
            </div>

        </div>
    </div>


    <div class="container-fluid">

        <div class="page-header">
            <h1>Create new widget</h1>
        </div>

        <!--Page navigaton for widget page(s): Insert the right links -->
        <nav class="images-nav">
            <ul>
                <li><a href="#">CREATE WIDGET</a>
                </li>
                <li><a href="#">MY WIDGETS</a>
                </li>
            </ul>
        </nav>

        <div class="row-fluid">
            <div class="span7" id="create-widget-container">
                <form action="/users/53abd26453a7be8a701794d4/imageMappingWidgets" method="POST" id="imageMappingWidget-form" class="form-horizontal" enctype="multipart/form-data">
                    <input type="hidden" name="authenticity_token" value="d365797c3b8580a92e17f6ad56f6dcfd5d5a53c8" />
                    <div id="widget-image-container" class="widget-image-container">
                        <img id="widget-image" class="widget-image" src="images/25.jpg">

                        <div class="widget-add-hotspot-overlay">
                            <span>
                                <p>Tap the image <br> where you want to add <br>your product hotspot!</p>
                            </span>
                        </div>

                    </div>

                    <div class="control-group">
                        <input name="ImageMappingWidget[name]" id="ImageMappingWidget_name" class="" type="text" value="" placeholder="Image name" />
                        <input id="image-width-tip" name="image-width" class="" type="text" value="" placeholder="Max. width in px. (optional)" />
                        <button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> Save widget</button>
                        <a href="/images" class="btn">Cancel</a>
                    </div>
                </form>
            </div>
            <div class="span5" id="add-products-container">
                <div id="product-search-container" class="fixed">
                    <h1 class="h1-sans-serif">Add hotspots</h1>

                    <div>
                        <div class="controls controls-row search-products">
                            <form class="form-inline">

                                <input name="search" class="span8" id="search" placeholder="Search products to add as hotspot" class="input-xlarge" value="" type="text" />
                                <select class="currency-selector span4">
                                    <option>DKK</option>
                                    <option>NOK</option>
                                    <option>SEK</option>
                                    <option>All</option>
                                </select>

                            </form>
                        </div>
                    </div>
                </div>

                <div id="empty-products-container">
                    <ol class="instructions">
                        <li>Search for products associated with your image.</li>
                        <li>Click a product you want to connect with your image</li>
                        <li>Click on your image to add hotspot with selected product.</li>
                    </ol>
                </div>
                <div id="masonry-container" class="masonry-container widget-product-container">
                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->

                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->
                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->
                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->
                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->
                    <!--            Masonry item: For each masonry item display image, dimensions and title.-->

                    <div class="masonry-item widget-product">
                        <img class="masonry-image" src="images/1.jpg" alt="c" />

                        <!--                Text content overlay (displays on hover): Make links to save the image and make widget-->
                        <div data-selected="false" class="text-content">
                            <span>
                            <p class="text-content-link">Add as hotspot</p>
                            </span>
                        </div>
                        <div class="blue-overlay">
                            <!--
                            <span>
                                <p class="text-content-link" href="">cancel</a>
                            </span>
-->
                        </div>

                        <div class="masonry-product-information product-tip">

                            <p class="masonry-brand-name">Norman Copenhagen</p>

                            <p class="masonry-product-name ">At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis.</p>

                            <p class="masonry-product-price">1000,- dkk.</p>

                        </div>

                    </div>
                    <!--            Masonry item end-->
                </div>



            </div>
        </div>

        <hr />
        <footer>
            <p>&copy; We Own It 2014</p>
        </footer>
    </div>

    <script src="javascripts/widget.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            //Tooltips:
            $(function () {
                //Product description tooltip 
                $('.product-tip').tooltip({
                    title: function () {
                        $brand = $(this).children('.masonry-brand-name').text();
                        $productname = $(this).children('.masonry-product-name').text();

                        return $brand + '. ' + $productname
                    },
                    placement: 'right'
                });

                //Tip on image width input field
                $('#image-width-tip').tooltip({
                    title: 'The max. image width is the width that the widget will be loaded at in your blogpost'
                });

                //Tip on image name input field
                $('#ImageMappingWidget_name').tooltip({
                    title: 'Preferably name your image the same as your blogpost'
                });
            });



            //Sets the height of the products masonry view to be relative to the rest of the content:
            $(function () {
                var $createWidgetContainerHeight = $('#create-widget-container').height();
                var $productSearchContainerHeight = $('#product-search-container').height();
                var $remainingHeight = ($createWidgetContainerHeight - $productSearchContainerHeight);
                $('.widget-product-container').css('max-height', $remainingHeight);
                $('#empty-products-container').css('min-height', $remainingHeight);
            });


            //Display instructions if no products are displayed from the beginning
            $(function () {
                if ($.trim($('.widget-product-container').html()).length == 0) {
                    $('#empty-products-container').css('display', 'block');
                } else {
                    $('#empty-products-container').css('display', 'none');
                }

            });

            //Search:
            $('#search').click(function () {
                alert('on search get the products and add them to #masonry-container');
            });

            
            
            
            
            
            

            //Click a product shows opaque overlay on widget image:
            $(function () {
                $('.blue-overlay').hide();
                $('.widget-add-hotspot-overlay').hide();

                $('.text-content').click(function (event) {
                    console.log('clicktarget .text-content ' + event.target);
                    showOverlays($(this));
//                    $('.text-content').hide();
//                    
//                    //Makes the widget overlay show:
//                    showWidgetOverlay();
//                    
//                    //Makes the blue overlay show on click on text-content:
//                    showBlueOverlay($(this));
                });

                $('.text-content-link').click(function (event) {
                    console.log('clicktarget .text-content-link ' + event.target);

                    showOverlays($(this).parent());

//                    $('.text-content').hide();
//                    showWidgetOverlay();
//                    showBlueOverlay($(this).parent());
//                    if ($(".blue-overlay").is(":visible")) {
//                        
//                        console.log('hide, remove obsolete code here');
//                    }
                    //Change code remove overlay again, make sure no other can be hovered

                });
            });
            
            var showOverlays = function ($element){
                    $('.text-content').hide();
                    //Makes the widget overlay show:
                    showWidgetOverlay();
                    //Makes the blue overlay show on click on text-content:
                    showBlueOverlay($element);
            }

            //Click anywhere on document, except on blue overlay and its
            $(document).click(function (e) {
                console.log($(".blue-overlay").is(":visible"));
                if ($(".blue-overlay").is(":visible")) {
                    console.log('is it really visible blue');
                    var $blueOverlays = $(".blue-overlay");
                    $visibleBlueOverlay = $blueOverlays.filter(':visible');
                    if (!$visibleBlueOverlay.is(e.target) && !$visibleBlueOverlay.parent().find($(".text-content-link")).is(e.target)) {
                        $(".blue-overlay").fadeOut("fast");
                        $(".widget-add-hotspot-overlay").fadeOut("fast");
                        console.log(e.target);
                    }
                }
            });

            //Show opaque overlay on widget, ready to make hotspot
            var showWidgetOverlay = function () {
                var $image = $("#widget-image");
                var $height = $image.height();
                var $width = $image.width();
                var $overlay = $(".widget-add-hotspot-overlay");
                $overlay.fadeIn('fast');
                $overlay.css("height", $height);
                $overlay.css("width", $width);
                //$(".text-content").hide();
            };

            var showBlueOverlay = function ($element) {
                var $blueOverlay = $element.parent().find($('.blue-overlay'));
                $blueOverlay.show();
                $productHeight = $element.parent().find($('.masonry-image')).height();
                $productWidth = $element.parent().find($('.masonry-image')).width();
                $blueOverlay.css("height", $productHeight);
                $blueOverlay.css("width", $productWidth);
            };

            
            
            
            
            
            
            
            
            
            
            

            //only if product is already selected:
            $('#widget-image').click(function () {
                addHotspot();
            });

            //only if product is already selected:
            $('.widget-add-hotspot-overlay').click(function () {
                $(this).fadeOut('fast');
                addHotspot();
            });

            var addHotspot = function () {
                alert('add hotspot on image only if product is choosen');
            };
        });
    </script>


</body>

</html>

